{% extends 'base.html' %}

{% block title %}Translate Metadata{% endblock %}

{% block content %}
<div class="container">
    <h1>Translate Metadata</h1>
    <p class="lead">Review and translate the metadata into other languages.</p>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Use the correct endpoint for saving translations -->
    <form method="POST" action="{{ url_for('save_api_details') }}">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">English Metadata</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="title_en" class="form-label">Title (EN):</label>
                    <input type="text" class="form-control" id="title_en" name="title_en" value="{{ translations['en']['title'] if translations and translations.get('en') else title }}">
                </div>
                <div class="mb-3">
                    <label for="description_en" class="form-label">Description (EN):</label>
                    <textarea class="form-control" id="description_en" name="description_en" rows="8">{{ translations['en']['description'] if translations and translations.get('en') else description }}</textarea>
                </div>
                <div class="mb-3">
                    <label for="keywords_en" class="form-label">Keywords (EN):</label>
                    <input type="text" class="form-control" id="keywords_en" name="keywords_en" value="{% if translations and translations.get('en') %}{{ translations['en']['keywords']|join(', ') }}{% else %}{{ keywords }}{% endif %}">
                    <small class="form-text text-muted">Comma-separated keywords</small>
                </div>
            </div>
        </div>

        <!-- German -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">German Metadata</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="title_de" class="form-label">Title (DE):</label>
                    <input type="text" class="form-control" id="title_de" name="title_de" value="{{ translations['de']['title'] if translations and translations.get('de') else title_de }}">
                </div>
                <div class="mb-3">
                    <label for="description_de" class="form-label">Description (DE):</label>
                    <textarea class="form-control" id="description_de" name="description_de" rows="8">{{ translations['de']['description'] if translations and translations.get('de') else description_de }}</textarea>
                </div>
                <div class="mb-3">
                    <label for="keywords_de" class="form-label">Keywords (DE):</label>
                    <input type="text" class="form-control" id="keywords_de" name="keywords_de" value="{% if translations and translations.get('de') %}{{ translations['de']['keywords']|join(', ') }}{% else %}{{ keywords_de }}{% endif %}">
                    <small class="form-text text-muted">Comma-separated keywords</small>
                </div>
            </div>
        </div>

        <!-- French -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">French Metadata</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="title_fr" class="form-label">Title (FR):</label>
                    <input type="text" class="form-control" id="title_fr" name="title_fr" value="{{ translations['fr']['title'] if translations and translations.get('fr') else title_fr }}">
                </div>
                <div class="mb-3">
                    <label for="description_fr" class="form-label">Description (FR):</label>
                    <textarea class="form-control" id="description_fr" name="description_fr" rows="8">{{ translations['fr']['description'] if translations and translations.get('fr') else description_fr }}</textarea>
                </div>
                <div class="mb-3">
                    <label for="keywords_fr" class="form-label">Keywords (FR):</label>
                    <input type="text" class="form-control" id="keywords_fr" name="keywords_fr" value="{% if translations and translations.get('fr') %}{{ translations['fr']['keywords']|join(', ') }}{% else %}{{ keywords_fr }}{% endif %}">
                    <small class="form-text text-muted">Comma-separated keywords</small>
                </div>
            </div>
        </div>

        <!-- Italian -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Italian Metadata</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="title_it" class="form-label">Title (IT):</label>
                    <input type="text" class="form-control" id="title_it" name="title_it" value="{{ translations['it']['title'] if translations and translations.get('it') else title_it }}">
                </div>
                <div class="mb-3">
                    <label for="description_it" class="form-label">Description (IT):</label>
                    <textarea class="form-control" id="description_it" name="description_it" rows="8">{{ translations['it']['description'] if translations and translations.get('it') else description_it }}</textarea>
                </div>
                <div class="mb-3">
                    <label for="keywords_it" class="form-label">Keywords (IT):</label>
                    <input type="text" class="form-control" id="keywords_it" name="keywords_it" value="{% if translations and translations.get('it') %}{{ translations['it']['keywords']|join(', ') }}{% else %}{{ keywords_it }}{% endif %}">
                    <small class="form-text text-muted">Comma-separated keywords</small>
                </div>
            </div>
        </div>

        <div class="form-group mb-4">
            <div class="d-flex justify-content-between">
                <a href="{{ url_for('ai') }}" class="btn btn-secondary">Back</a>
                <button type="submit" class="btn btn-primary">Next: Review & Submit</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}